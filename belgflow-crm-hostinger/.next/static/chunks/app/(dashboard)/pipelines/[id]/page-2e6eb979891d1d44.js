(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[328],{4414:function(e,a,s){Promise.resolve().then(s.bind(s,9332)),Promise.resolve().then(s.bind(s,7771))},1402:function(e,a,s){"use strict";s.d(a,{$X:function(){return t.$X},D9:function(){return t.D9},DC:function(){return t.DC},Ey:function(){return t.Ey},FJ:function(){return t.FJ},Gj:function(){return t.Gj},IH:function(){return t.IH},Jj:function(){return t.Jj},LI:function(){return t.LI},Ld:function(){return t.Ld},Nq:function(){return t.Nq},Re:function(){return t.Re},UG:function(){return t.UG},Yz:function(){return t.Yz},qk:function(){return t.qk},r3:function(){return t.r3},so:function(){return t.so},ux:function(){return t.ux},vZ:function(){return t.vZ},vd:function(){return t.vd},wm:function(){return t.wm},zX:function(){return t.zX}});var t=s(9892)},941:function(e,a,s){"use strict";s.d(a,{HB:function(){return t.HB},LI:function(){return t.LI},Ld:function(){return t.Ld},ux:function(){return t.ux},vd:function(){return t.vd}});var t=s(9892)},2588:function(e,a,s){"use strict";s.d(a,{Cj:function(){return t.Cj},O1:function(){return t.O1},VK:function(){return t.VK},Zj:function(){return t.Zj},g4:function(){return t.g4}});var t=s(795)},9713:function(e,a,s){"use strict";s.d(a,{i:function(){return m}});var t=s(7437),n=s(2265),i=s(9376),l=s(8933),r=s(4291),d=s(2381),o=s(279),c=s(5060),u=s(4438);function m(e){let{open:a,onOpenChange:s,onCreated:m}=e,x=(0,i.useRouter)(),[h,p]=(0,n.useState)(""),[f,g]=(0,n.useState)(""),[j,v]=(0,n.useState)(!1),_=async e=>{if(e.preventDefault(),!h.trim()){u.Am.error("Nome \xe9 obrigat\xf3rio");return}v(!0);try{let e=(0,l.e)(),{data:{user:a}}=await e.auth.getUser();if(!a)throw Error("N\xe3o autenticado");let{data:t,error:n}=await e.from("pipelines").insert({name:h.trim(),description:f.trim()||null,created_by:a.id}).select("id").single();if(n)throw n;let{error:i}=await e.from("pipeline_members").insert({pipeline_id:t.id,user_id:a.id,role_in_pipeline:"admin"});if(i)throw i;let{error:r}=await e.from("stages").insert([{name:"Entrada",position:0},{name:"Qualifica\xe7\xe3o",position:1},{name:"Proposta",position:2},{name:"Negocia\xe7\xe3o",position:3},{name:"Fechado",position:4}].map(e=>({pipeline_id:t.id,name:e.name,position:e.position})));if(r)throw r;p(""),g(""),s(!1),u.Am.success("Pipeline criado com sucesso!"),m?m(t.id):(x.push("/pipelines/".concat(t.id)),x.refresh())}catch(a){let e=a&&"object"==typeof a&&"message"in a?String(a.message):a instanceof Error?a.message:"Erro ao criar pipeline";u.Am.error(e)}finally{v(!1)}},D=()=>{p(""),g(""),s(!1)};return(0,t.jsx)(r.Vq,{open:a,onOpenChange:D,children:(0,t.jsxs)(r.cZ,{children:[(0,t.jsxs)(r.fK,{children:[(0,t.jsx)(r.$N,{children:"Novo Pipeline"}),(0,t.jsx)(r.Be,{children:"Crie um novo pipeline com est\xe1gios padr\xe3o (Entrada, Qualifica\xe7\xe3o, Proposta, Negocia\xe7\xe3o, Fechado)"})]}),(0,t.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"pipeline-name",children:"Nome do pipeline *"}),(0,t.jsx)(o.I,{id:"pipeline-name",placeholder:"Ex: Vendas 2025",value:h,onChange:e=>p(e.target.value),required:!0,disabled:j})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(c._,{htmlFor:"pipeline-desc",children:"Descri\xe7\xe3o (opcional)"}),(0,t.jsx)(o.I,{id:"pipeline-desc",placeholder:"Breve descri\xe7\xe3o do pipeline",value:f,onChange:e=>g(e.target.value),disabled:j})]}),(0,t.jsxs)(r.cN,{children:[(0,t.jsx)(d.z,{type:"button",variant:"outline",onClick:D,children:"Cancelar"}),(0,t.jsx)(d.z,{type:"submit",disabled:j||!h.trim(),children:j?"Criando...":"Criar pipeline"})]})]})]})})}},9332:function(e,a,s){"use strict";s.d(a,{PipelineNameSetter:function(){return i}});var t=s(2265),n=s(7673);function i(e){let{name:a}=e,{setPipelineName:s}=(0,n.V)();return(0,t.useEffect)(()=>(s(a),()=>s(null)),[a,s]),null}},7771:function(e,a,s){"use strict";s.d(a,{PipelineView:function(){return ea}});var t=s(7437),n=s(2265),i=s(9376),l=s(9397),r=s(2381),d=s(5291),o=s(9713),c=s(8933),u=s(4291),m=s(279),x=s(5060);let h=[{code:"32",country:"B\xe9lgica",flag:"\uD83C\uDDE7\uD83C\uDDEA"},{code:"55",country:"Brasil",flag:"\uD83C\uDDE7\uD83C\uDDF7"},{code:"1",country:"EUA/Canad\xe1",flag:"\uD83C\uDDFA\uD83C\uDDF8"},{code:"351",country:"Portugal",flag:"\uD83C\uDDF5\uD83C\uDDF9"},{code:"34",country:"Espanha",flag:"\uD83C\uDDEA\uD83C\uDDF8"},{code:"33",country:"Fran\xe7a",flag:"\uD83C\uDDEB\uD83C\uDDF7"},{code:"49",country:"Alemanha",flag:"\uD83C\uDDE9\uD83C\uDDEA"},{code:"39",country:"It\xe1lia",flag:"\uD83C\uDDEE\uD83C\uDDF9"},{code:"44",country:"Reino Unido",flag:"\uD83C\uDDEC\uD83C\uDDE7"},{code:"52",country:"M\xe9xico",flag:"\uD83C\uDDF2\uD83C\uDDFD"},{code:"54",country:"Argentina",flag:"\uD83C\uDDE6\uD83C\uDDF7"},{code:"56",country:"Chile",flag:"\uD83C\uDDE8\uD83C\uDDF1"},{code:"57",country:"Col\xf4mbia",flag:"\uD83C\uDDE8\uD83C\uDDF4"},{code:"58",country:"Venezuela",flag:"\uD83C\uDDFB\uD83C\uDDEA"},{code:"51",country:"Peru",flag:"\uD83C\uDDF5\uD83C\uDDEA"},{code:"595",country:"Paraguai",flag:"\uD83C\uDDF5\uD83C\uDDFE"},{code:"598",country:"Uruguai",flag:"\uD83C\uDDFA\uD83C\uDDFE"},{code:"31",country:"Holanda",flag:"\uD83C\uDDF3\uD83C\uDDF1"},{code:"86",country:"China",flag:"\uD83C\uDDE8\uD83C\uDDF3"},{code:"81",country:"Jap\xe3o",flag:"\uD83C\uDDEF\uD83C\uDDF5"},{code:"91",country:"\xcdndia",flag:"\uD83C\uDDEE\uD83C\uDDF3"},{code:"7",country:"R\xfassia",flag:"\uD83C\uDDF7\uD83C\uDDFA"},{code:"61",country:"Austr\xe1lia",flag:"\uD83C\uDDE6\uD83C\uDDFA"},{code:"27",country:"\xc1frica do Sul",flag:"\uD83C\uDDFF\uD83C\uDDE6"},{code:"234",country:"Nig\xe9ria",flag:"\uD83C\uDDF3\uD83C\uDDEC"},{code:"971",country:"EAU",flag:"\uD83C\uDDE6\uD83C\uDDEA"},{code:"353",country:"Irlanda",flag:"\uD83C\uDDEE\uD83C\uDDEA"},{code:"43",country:"\xc1ustria",flag:"\uD83C\uDDE6\uD83C\uDDF9"},{code:"41",country:"Su\xed\xe7a",flag:"\uD83C\uDDE8\uD83C\uDDED"},{code:"48",country:"Pol\xf4nia",flag:"\uD83C\uDDF5\uD83C\uDDF1"},{code:"46",country:"Su\xe9cia",flag:"\uD83C\uDDF8\uD83C\uDDEA"},{code:"47",country:"Noruega",flag:"\uD83C\uDDF3\uD83C\uDDF4"},{code:"45",country:"Dinamarca",flag:"\uD83C\uDDE9\uD83C\uDDF0"},{code:"358",country:"Finl\xe2ndia",flag:"\uD83C\uDDEB\uD83C\uDDEE"},{code:"30",country:"Gr\xe9cia",flag:"\uD83C\uDDEC\uD83C\uDDF7"},{code:"90",country:"Turquia",flag:"\uD83C\uDDF9\uD83C\uDDF7"},{code:"62",country:"Indon\xe9sia",flag:"\uD83C\uDDEE\uD83C\uDDE9"},{code:"65",country:"Singapura",flag:"\uD83C\uDDF8\uD83C\uDDEC"},{code:"60",country:"Mal\xe1sia",flag:"\uD83C\uDDF2\uD83C\uDDFE"},{code:"66",country:"Tail\xe2ndia",flag:"\uD83C\uDDF9\uD83C\uDDED"},{code:"84",country:"Vietn\xe3",flag:"\uD83C\uDDFB\uD83C\uDDF3"}];function p(e){let{countryCode:a,number:s,onCountryCodeChange:n,onNumberChange:i,placeholder:l="99999-9999",disabled:r,id:o}=e;return(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(d.Ph,{value:a||"32",onValueChange:n,disabled:r,children:[(0,t.jsx)(d.i4,{className:"w-[110px] shrink-0",children:(0,t.jsx)(d.ki,{placeholder:"+32"})}),(0,t.jsx)(d.Bw,{children:h.map(e=>(0,t.jsxs)(d.Ql,{value:e.code,children:[e.flag," +",e.code]},e.code))})]}),(0,t.jsx)(m.I,{id:o,placeholder:l,value:s,onChange:e=>i(e.target.value),disabled:r,className:"flex-1"})]})}var f=s(4438),g=s(3448);let j=["Brasil","Portugal","Espanha","Argentina","EUA","Reino Unido","Fran\xe7a","Alemanha","It\xe1lia","M\xe9xico","Chile","Col\xf4mbia","Outro"];function v(e){var a,s;let{open:i,onOpenChange:l,pipelineId:o,stageId:h,stageName:v,position:_,stages:D,onLeadCreated:N}=e,[y,C]=(0,n.useState)(h||""),b=h||y,w=null==D?void 0:D.find(e=>e.id===b),E=v||(null==w?void 0:w.name)||"",A=null!=_?_:null!==(s=null==w?void 0:null===(a=w.leads)||void 0===a?void 0:a.length)&&void 0!==s?s:0,[k,S]=(0,n.useState)(""),[z,F]=(0,n.useState)(""),[R,I]=(0,n.useState)("32"),[V,P]=(0,n.useState)(""),[Z,q]=(0,n.useState)(""),[B,O]=(0,n.useState)("__none__"),[L,Q]=(0,n.useState)(""),[T,U]=(0,n.useState)(!1),Y=async e=>{if(e.preventDefault(),!k.trim()){f.Am.error("Nome/empresa \xe9 obrigat\xf3rio");return}if(!b){f.Am.error("Selecione o est\xe1gio");return}U(!0);try{let e=V.trim()?"".concat(R).concat(V.replace(/\D/g,"")):null,a=L?parseFloat(String(L).replace(/\./g,"").replace(",",".")):null,s=null==a||Number.isNaN(a)?null:a,{data:t,error:n}=await (0,c.e)().from("leads").insert({pipeline_id:o,stage_id:b,title:k.trim(),email:z.trim()||null,phone:V.trim()||null,phone_country_code:V.trim()?R:null,whatsapp:e,resumo:Z.trim()||null,nacionalidade:B&&"__none__"!==B?B:null,valor:null!=s?s:null,source:"manual",position:A}).select().single();if(n)throw n;await (0,c.e)().from("lead_activities").insert({lead_id:t.id,type:"created",payload:{}}),S(""),F(""),P(""),I("32"),q(""),O("__none__"),Q(""),l(!1),N(t),f.Am.success("Lead adicionado!")}catch(e){f.Am.error((0,g.e)(e,"Erro ao criar lead"))}finally{U(!1)}},W=()=>{S(""),F(""),P(""),I("55"),q(""),O("__none__"),Q(""),l(!1)};return(0,t.jsx)(u.Vq,{open:i,onOpenChange:W,children:(0,t.jsxs)(u.cZ,{className:"max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(u.fK,{children:[(0,t.jsx)(u.$N,{children:"Adicionar lead"}),(0,t.jsx)(u.Be,{children:E?"Novo lead no est\xe1gio ".concat(E):"Preencha os dados do lead"})]}),(0,t.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[D&&D.length>0&&!h&&(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Est\xe1gio *"}),(0,t.jsxs)(d.Ph,{value:b,onValueChange:C,required:!0,disabled:T,children:[(0,t.jsx)(d.i4,{children:(0,t.jsx)(d.ki,{placeholder:"Selecione o est\xe1gio"})}),(0,t.jsx)(d.Bw,{children:D.map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"lead-title",children:"Nome / Empresa *"}),(0,t.jsx)(m.I,{id:"lead-title",placeholder:"Ex: Empresa XYZ",value:k,onChange:e=>S(e.target.value),required:!0,disabled:T})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Telefone / WhatsApp (com DDI do pa\xeds)"}),(0,t.jsx)(p,{countryCode:R,number:V,onCountryCodeChange:I,onNumberChange:P,placeholder:"(11) 99999-9999",disabled:T})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"lead-email",children:"Email"}),(0,t.jsx)(m.I,{id:"lead-email",type:"email",placeholder:"contato@empresa.com",value:z,onChange:e=>F(e.target.value),disabled:T})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"lead-resumo",children:"Resumo"}),(0,t.jsx)("textarea",{id:"lead-resumo",className:"w-full min-h-[60px] rounded-md border px-3 py-2 text-sm",placeholder:"Breve resumo do lead...",value:Z,onChange:e=>q(e.target.value),disabled:T})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Poss\xedvel nacionalidade"}),(0,t.jsxs)(d.Ph,{value:B,onValueChange:O,disabled:T,children:[(0,t.jsx)(d.i4,{children:(0,t.jsx)(d.ki,{placeholder:"Selecione"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"__none__",children:"Nenhuma"}),j.map(e=>(0,t.jsx)(d.Ql,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"lead-valor",children:"Valor (€)"}),(0,t.jsx)(m.I,{id:"lead-valor",type:"text",inputMode:"decimal",placeholder:"Ex: 1.000,00 ou 1000",value:L,onChange:e=>Q(e.target.value),disabled:T})]}),(0,t.jsxs)(u.cN,{children:[(0,t.jsx)(r.z,{type:"button",variant:"outline",onClick:W,children:"Cancelar"}),(0,t.jsx)(r.z,{type:"submit",disabled:T||!k.trim()||!b,children:T?"Adicionando...":"Adicionar"})]})]})]})})}function _(e){let{pipelines:a,currentPipelineId:s,stages:c=[],onLeadAdded:u,members:m=[],assigneeFilter:x="__all__",onAssigneeFilterChange:h}=e,p=(0,i.useRouter)(),[f,g]=(0,n.useState)(!1),[j,_]=(0,n.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-wrap items-center gap-3",children:[(0,t.jsxs)(d.Ph,{value:s,onValueChange:e=>p.push("/pipelines/".concat(e)),children:[(0,t.jsx)(d.i4,{className:"w-[220px]",children:(0,t.jsx)(d.ki,{placeholder:"Selecione o pipeline"})}),(0,t.jsx)(d.Bw,{children:a.map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.name},e.id))})]}),(0,t.jsxs)(r.z,{variant:"outline",size:"sm",onClick:()=>g(!0),children:[(0,t.jsx)(l.Z,{className:"mr-2 size-4"}),"Novo pipeline"]}),c.length>0&&(0,t.jsxs)(r.z,{size:"sm",onClick:()=>_(!0),children:[(0,t.jsx)(l.Z,{className:"mr-2 size-4"}),"Adicionar lead"]}),h&&(0,t.jsxs)(d.Ph,{value:x,onValueChange:h,children:[(0,t.jsx)(d.i4,{className:"w-[180px]",children:(0,t.jsx)(d.ki,{placeholder:"Respons\xe1vel"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"__all__",children:"Todos"}),(0,t.jsx)(d.Ql,{value:"__unassigned__",children:"N\xe3o atribu\xeddos"}),m.filter(e=>e.name||e.email).map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.name||e.email},e.id))]})]})]}),(0,t.jsx)(v,{open:j,onOpenChange:_,pipelineId:s,stages:c,onLeadCreated:()=>{null==u||u(),p.refresh()}}),(0,t.jsx)(o.i,{open:f,onOpenChange:g,onCreated:e=>{p.push("/pipelines/".concat(e)),p.refresh()}})]})}var D=s(795),N=s(3662),y=s(7782),C=s(5675),b=s(8930),w=s(9892),E=s(6246),A=s(9174),k=s(9820),S=s(2060);function z(e){var a,s,n;let{lead:i,onClick:l,onDelete:d}=e,{attributes:o,listeners:c,setNodeRef:u,transform:m,transition:x,isDragging:h}=(0,N.nB)({id:"lead-".concat(i.id)}),p={transform:w.ux.Transform.toString(m),transition:x},f=(null===(a=i.lead_tags)||void 0===a?void 0:a.map(e=>e.tag))||[],g=i.profiles;return(0,t.jsx)(k.Zb,{ref:u,style:p,...o,...c,className:"cursor-grab active:cursor-grabbing mb-2 ".concat(h?"opacity-50 shadow-lg":""),onClick:l,children:(0,t.jsxs)(k.aY,{className:"p-3",children:[(0,t.jsx)("p",{className:"font-medium text-sm line-clamp-2",children:i.title}),i.email&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:i.email}),f.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[f.slice(0,3).map(e=>(0,t.jsx)(A.C,{variant:"secondary",className:"text-xs",children:e},e)),f.length>3&&(0,t.jsxs)(A.C,{variant:"outline",className:"text-xs",children:["+",f.length-3]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-2 gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground truncate",children:i.source}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0",children:[g&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-xs text-muted-foreground truncate",title:g.name||g.email,children:[(0,t.jsx)(E.qE,{className:"size-5 shrink-0",children:(0,t.jsx)(E.Q5,{className:"text-[10px]",children:(null===(s=g.name)||void 0===s?void 0:s.charAt(0))||(null===(n=g.email)||void 0===n?void 0:n.charAt(0))||"?"})}),(0,t.jsx)("span",{className:"truncate",children:g.name||g.email||"—"})]}),d&&(0,t.jsxs)(S.h_,{children:[(0,t.jsx)(S.$F,{asChild:!0,children:(0,t.jsx)(r.z,{variant:"ghost",size:"icon",className:"size-6",onClick:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),children:(0,t.jsx)(y.Z,{className:"size-3"})})}),(0,t.jsx)(S.AW,{align:"end",onClick:e=>e.stopPropagation(),children:(0,t.jsxs)(S.Xi,{className:"text-destructive",onClick:e=>{e.stopPropagation(),confirm("Excluir este lead?")&&d(i.id)},children:[(0,t.jsx)(b.Z,{className:"mr-2 size-3"}),"Excluir"]})})]})]})]})]})})}function F(e){let{open:a,onOpenChange:s,stageName:i,onSave:l}=e,[d,o]=(0,n.useState)(i),[c,h]=(0,n.useState)(!1),p=async e=>{if(e.preventDefault(),d.trim()){h(!0);try{await l(d.trim()),s(!1)}finally{h(!1)}}};return(0,t.jsx)(u.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[(0,t.jsx)(u.$N,{children:"Renomear est\xe1gio"}),(0,t.jsx)(u.Be,{children:"Altere o nome do est\xe1gio"})]}),(0,t.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Nome"}),(0,t.jsx)(m.I,{value:d,onChange:e=>o(e.target.value),placeholder:"Ex: Qualifica\xe7\xe3o",disabled:c})]}),(0,t.jsxs)(u.cN,{children:[(0,t.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),(0,t.jsx)(r.z,{type:"submit",disabled:c||!d.trim(),children:"Salvar"})]})]})]})})}function R(e){let{stage:a,onLeadClick:s,onLeadCreated:i,onLeadDelete:d,pipelineId:o,onEditStage:c,onDeleteStage:u,canEditStages:m=!1}=e,{setNodeRef:x,isOver:h}=(0,D.Zj)({id:"stage-".concat(a.id)}),[p,f]=(0,n.useState)(!1),[g,j]=(0,n.useState)(!1);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{ref:x,className:"flex w-72 shrink-0 flex-col rounded-lg border bg-muted/30 transition-colors ".concat(h?"border-primary/50 bg-muted/50":""),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1 border-b p-3",children:[(0,t.jsx)("h3",{className:"truncate font-semibold",children:a.name}),(0,t.jsxs)("div",{className:"flex shrink-0 items-center gap-1",children:[(0,t.jsx)("span",{className:"text-muted-foreground text-sm",children:a.leads.length}),m&&(c||u)&&(0,t.jsxs)(S.h_,{children:[(0,t.jsx)(S.$F,{asChild:!0,children:(0,t.jsx)(r.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,t.jsx)(y.Z,{className:"size-4"})})}),(0,t.jsxs)(S.AW,{align:"end",children:[c&&(0,t.jsxs)(S.Xi,{onClick:()=>j(!0),children:[(0,t.jsx)(C.Z,{className:"mr-2 size-4"}),"Renomear"]}),u&&(0,t.jsxs)(S.Xi,{onClick:()=>u(a.id),className:"text-destructive",children:[(0,t.jsx)(b.Z,{className:"mr-2 size-4"}),"Excluir est\xe1gio"]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex min-h-[200px] flex-1 flex-col overflow-y-auto p-2",children:[(0,t.jsx)(N.Fo,{items:a.leads.map(e=>"lead-".concat(e.id)),strategy:N.qw,children:a.leads.map(e=>(0,t.jsx)(z,{lead:e,onClick:()=>s(e.id),onDelete:d},e.id))}),(0,t.jsxs)(r.z,{variant:"ghost",size:"sm",className:"mt-2 w-full justify-start text-muted-foreground",onClick:()=>f(!0),children:[(0,t.jsx)(l.Z,{className:"mr-2 size-4"}),"Adicionar lead"]})]})]}),(0,t.jsx)(v,{open:p,onOpenChange:f,pipelineId:o,stageId:a.id,stageName:a.name,position:a.leads.length,onLeadCreated:i}),c&&(0,t.jsx)(F,{open:g,onOpenChange:j,stageName:a.name,onSave:async e=>{await c(a.id,e),j(!1)}})]})}function I(e){var a,s,n;let{lead:i}=e,l=(null===(a=i.lead_tags)||void 0===a?void 0:a.map(e=>e.tag))||[],r=i.profiles;return(0,t.jsx)(k.Zb,{className:"cursor-grabbing shadow-xl ring-2 ring-primary/20 rotate-2 scale-105",children:(0,t.jsxs)(k.aY,{className:"p-3",children:[(0,t.jsx)("p",{className:"font-medium text-sm line-clamp-2",children:i.title}),i.email&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:i.email}),l.length>0&&(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[l.slice(0,3).map(e=>(0,t.jsx)(A.C,{variant:"secondary",className:"text-xs",children:e},e)),l.length>3&&(0,t.jsxs)(A.C,{variant:"outline",className:"text-xs",children:["+",l.length-3]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-2 gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground truncate",children:i.source}),r&&(0,t.jsxs)("span",{className:"flex items-center gap-1 text-xs text-muted-foreground truncate",title:r.name||r.email,children:[(0,t.jsx)(E.qE,{className:"size-5 shrink-0",children:(0,t.jsx)(E.Q5,{className:"text-[10px]",children:(null===(s=r.name)||void 0===s?void 0:s.charAt(0))||(null===(n=r.email)||void 0===n?void 0:n.charAt(0))||"?"})}),(0,t.jsx)("span",{className:"truncate",children:r.name||r.email||"—"})]})]})]})})}var V=s(1032),P=s(9529);let Z=P.fC,q=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(P.aV,{ref:a,className:(0,g.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s),...n})});q.displayName=P.aV.displayName;let B=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(P.xz,{ref:a,className:(0,g.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s),...n})});B.displayName=P.xz.displayName;let O=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(P.VY,{ref:a,className:(0,g.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...n})});O.displayName=P.VY.displayName;var L=s(9140),Q=s(7060);let T=n.forwardRef((e,a)=>{let{className:s,children:n,...i}=e;return(0,t.jsxs)(Q.fC,{ref:a,className:(0,g.cn)("relative overflow-hidden",s),...i,children:[(0,t.jsx)(Q.l_,{className:"h-full w-full rounded-[inherit]",children:n}),(0,t.jsx)(U,{}),(0,t.jsx)(Q.Ns,{})]})});T.displayName=Q.fC.displayName;let U=n.forwardRef((e,a)=>{let{className:s,orientation:n="vertical",...i}=e;return(0,t.jsx)(Q.gb,{ref:a,orientation:n,className:(0,g.cn)("flex touch-none select-none transition-colors","vertical"===n&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...i,children:(0,t.jsx)(Q.q4,{className:"relative flex-1 rounded-full bg-border"})})});U.displayName=Q.gb.displayName;var Y=s(9345),W=s(3041),M=s(9202),$=s(3417);function X(e){let{open:a,onOpenChange:s,leadId:i,onTaskCreated:l,members:o}=e,[h,p]=(0,n.useState)(""),[g,j]=(0,n.useState)(""),[v,_]=(0,n.useState)(""),[D,N]=(0,n.useState)("__none__"),[y,C]=(0,n.useState)(!1),b=async e=>{if(e.preventDefault(),!h.trim()){f.Am.error("T\xedtulo \xe9 obrigat\xf3rio");return}C(!0);try{let{error:e}=await (0,c.e)().from("tasks").insert({lead_id:i,title:h.trim(),description:g.trim()||null,due_date:v||null,assigned_to:D&&"__none__"!==D?D:null,status:"pending"});if(e)throw e;p(""),j(""),_(""),N("__none__"),s(!1),l(),f.Am.success("Tarefa adicionada!")}catch(e){f.Am.error(e instanceof Error?e.message:"Erro ao criar tarefa")}finally{C(!1)}},w=()=>{p(""),j(""),_(""),N("__none__"),s(!1)};return(0,t.jsx)(u.Vq,{open:a,onOpenChange:w,children:(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[(0,t.jsx)(u.$N,{children:"Nova tarefa"}),(0,t.jsx)(u.Be,{children:"Adicionar tarefa ao lead"})]}),(0,t.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"task-title",children:"T\xedtulo *"}),(0,t.jsx)(m.I,{id:"task-title",placeholder:"Ex: Ligar para o cliente",value:h,onChange:e=>p(e.target.value),required:!0,disabled:y})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"task-desc",children:"Descri\xe7\xe3o"}),(0,t.jsx)("textarea",{id:"task-desc",className:"w-full min-h-[60px] rounded-md border px-3 py-2 text-sm",placeholder:"Detalhes da tarefa...",value:g,onChange:e=>j(e.target.value),disabled:y})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{htmlFor:"task-due",children:"Data de vencimento"}),(0,t.jsx)(m.I,{id:"task-due",type:"date",value:v,onChange:e=>_(e.target.value),disabled:y})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Atribuir a"}),(0,t.jsxs)(d.Ph,{value:D,onValueChange:N,disabled:y,children:[(0,t.jsx)(d.i4,{children:(0,t.jsx)(d.ki,{placeholder:"Ningu\xe9m"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"__none__",children:"Ningu\xe9m"}),o.map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.name||e.email},e.id))]})]})]}),(0,t.jsxs)(u.cN,{children:[(0,t.jsx)(r.z,{type:"button",variant:"outline",onClick:w,children:"Cancelar"}),(0,t.jsx)(r.z,{type:"submit",disabled:y||!h.trim(),children:y?"Adicionando...":"Adicionar"})]})]})]})})}var K=s(3282);let H=["Brasil","Portugal","Espanha","Argentina","EUA","Reino Unido","Fran\xe7a","Alemanha","It\xe1lia","M\xe9xico","Chile","Col\xf4mbia","Outro"];function G(e){let{leadId:a,members:s,open:i,onClose:o,onUpdate:u,onDelete:h}=e,[j,v]=(0,n.useState)(null),[_,D]=(0,n.useState)([]),[N,y]=(0,n.useState)([]),[w,E]=(0,n.useState)(!0),[k,S]=(0,n.useState)(!1),[z,F]=(0,n.useState)(!1),[R,I]=(0,n.useState)({title:"",email:"",phone:"",phone_country_code:"32",whatsapp:"",website:"",source:"manual",notes:"",assignee_user_id:"",resumo:"",nacionalidade:"",valor:""}),[P,Q]=(0,n.useState)(!1),[U,G]=(0,n.useState)(!1),[J,ee]=(0,n.useState)(null),[ea,es]=(0,n.useState)(""),[et,en]=(0,n.useState)(""),ei=(0,c.e)();(0,n.useEffect)(()=>{i&&a&&(async()=>{E(!0);let{data:e}=await ei.from("leads").select("\n          *,\n          lead_tags(tag)\n        ").eq("id",a).single();if(e){v(e);let a=e.phone_country_code||"32",s=String(e.whatsapp||"").replace(/\D/g,""),t=e.phone||"",n=t;if(s&&!t){let e=a.replace(/\D/g,"");n=s.startsWith(e)?s.slice(e.length):s}I({title:e.title||"",email:e.email||"",phone:n||t.replace(/\D/g,""),phone_country_code:a,whatsapp:s,website:e.website||"",source:e.source||"manual",notes:e.notes||"",assignee_user_id:e.assignee_user_id||"",resumo:e.resumo||"",nacionalidade:e.nacionalidade||"",valor:null!=e.valor?String(e.valor):""})}let{data:s}=await ei.from("lead_activities").select("*").eq("lead_id",a).order("created_at",{ascending:!1});D(s||[]);let{data:t}=await ei.from("tasks").select("*").eq("lead_id",a).order("due_date",{ascending:!0});y(t||[]),E(!1)})()},[i,a]);let el=async()=>{if(confirm("Excluir este lead? Esta a\xe7\xe3o n\xe3o pode ser desfeita."))try{let{error:e}=await ei.from("leads").delete().eq("id",a);if(e)throw e;f.Am.success("Lead exclu\xeddo"),o(),null==h||h(a),u()}catch(e){f.Am.error((0,g.e)(e,"Erro ao excluir lead"))}},er=async e=>{let s=R.assignee_user_id,t=s&&"__none__"!==s?s:null,n=e&&"__none__"!==e?e:null;if(t!==n){I(a=>({...a,assignee_user_id:e}));try{let{error:e}=await ei.from("leads").update({assignee_user_id:n}).eq("id",a);if(e)throw e;await ei.from("lead_activities").insert({lead_id:a,type:"assignee_change",payload:{old_assignee_id:t,new_assignee_id:n}}),D(e=>[{type:"assignee_change",payload:{old_assignee_id:t,new_assignee_id:n},created_at:new Date().toISOString()},...e]),f.Am.success("Respons\xe1vel atualizado"),u()}catch(e){I(e=>({...e,assignee_user_id:s})),f.Am.error((0,g.e)(e,"Erro ao alterar respons\xe1vel"))}}},ed=async()=>{S(!0);let e=R.assignee_user_id;try{let s=R.phone?"".concat(R.phone_country_code).concat(R.phone.replace(/\D/g,"")):null,t=R.valor?(()=>{let e=parseFloat(String(R.valor).replace(/\./g,"").replace(",","."));return null==e||Number.isNaN(e)?null:e})():null,n=R.assignee_user_id&&"__none__"!==R.assignee_user_id?R.assignee_user_id:null,{error:i}=await ei.from("leads").update({title:R.title,email:R.email||null,phone:R.phone||null,phone_country_code:R.phone?R.phone_country_code:null,whatsapp:s,website:R.website||null,source:R.source,notes:R.notes||null,assignee_user_id:n,resumo:R.resumo||null,nacionalidade:R.nacionalidade&&"__none__"!==R.nacionalidade?R.nacionalidade:null,valor:t}).eq("id",a);if(i)throw i;(e||"__none__")!==(n||"__none__")&&await ei.from("lead_activities").insert({lead_id:a,type:"assignee_change",payload:{old_assignee_id:e&&"__none__"!==e?e:null,new_assignee_id:n}}),await ei.from("lead_activities").insert({lead_id:a,type:"field_edit",payload:{fields:Object.keys(R)}}),f.Am.success("Lead atualizado"),F(!1),u(!0)}catch(e){f.Am.error((0,g.e)(e,"Erro ao salvar"))}finally{S(!1)}},eo=async()=>{if(!ea.trim())return;let e=ea.trim();try{await ei.from("lead_activities").insert({lead_id:a,type:"note_added",payload:{note:e}});let s=[R.notes,e].filter(Boolean).join("\n\n"),{error:t}=await ei.from("leads").update({notes:s}).eq("id",a);if(t)throw t;I(e=>({...e,notes:s})),es(""),D(a=>[{type:"note_added",payload:{note:e},created_at:new Date().toISOString()},...a]),f.Am.success("Nota adicionada"),u()}catch(e){f.Am.error("Erro ao adicionar nota")}},ec=async()=>{if(!et.trim())return;let e=et.trim().toLowerCase();try{await ei.from("lead_tags").insert({lead_id:a,tag:e}),await ei.from("lead_activities").insert({lead_id:a,type:"tag_added",payload:{tag:e}}),v(a=>a?{...a,lead_tags:[...a.lead_tags||[],{tag:e}]}:null),en(""),f.Am.success("Tag adicionada"),u()}catch(e){f.Am.error("Tag j\xe1 existe ou erro ao adicionar")}},eu=async e=>{try{await ei.from("lead_tags").delete().eq("lead_id",a).eq("tag",e),v(a=>a?{...a,lead_tags:(a.lead_tags||[]).filter(a=>a.tag!==e)}:null),u()}catch(e){f.Am.error("Erro ao remover tag")}},em=(null==j?void 0:j.lead_tags)||[];return(0,t.jsx)(V.yo,{open:i,onOpenChange:e=>!e&&o(),children:(0,t.jsxs)(V.ue,{className:"w-full sm:max-w-lg overflow-y-auto",children:[(0,t.jsxs)(V.Tu,{children:[(0,t.jsx)(V.bC,{children:"Detalhes do Lead"}),(0,t.jsx)(V.Ei,{children:"Visualize e edite as informa\xe7\xf5es do lead"})]}),w?(0,t.jsxs)("div",{className:"space-y-4 mt-6",children:[(0,t.jsx)(L.O,{className:"h-8 w-full"}),(0,t.jsx)(L.O,{className:"h-20 w-full"})]}):j?(0,t.jsxs)(Z,{defaultValue:"details",className:"mt-6",children:[(0,t.jsxs)(q,{children:[(0,t.jsx)(B,{value:"details",children:"Detalhes"}),(0,t.jsx)(B,{value:"activity",children:"Atividades"}),(0,t.jsx)(B,{value:"tasks",children:"Tarefas"})]}),(0,t.jsx)(O,{value:"details",className:"space-y-4 mt-4",children:z?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Nome/Empresa"}),(0,t.jsx)(m.I,{value:R.title,onChange:e=>I(a=>({...a,title:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Email"}),(0,t.jsx)(m.I,{type:"email",value:R.email,onChange:e=>I(a=>({...a,email:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Telefone / WhatsApp (DDI + n\xfamero)"}),(0,t.jsx)(p,{countryCode:R.phone_country_code,number:R.phone,onCountryCodeChange:e=>I(a=>({...a,phone_country_code:e})),onNumberChange:e=>I(a=>({...a,phone:e}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Site"}),(0,t.jsx)(m.I,{value:R.website,onChange:e=>I(a=>({...a,website:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Resumo"}),(0,t.jsx)("textarea",{className:"w-full min-h-[60px] rounded-md border px-3 py-2 text-sm",value:R.resumo,onChange:e=>I(a=>({...a,resumo:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Poss\xedvel nacionalidade"}),(0,t.jsxs)(d.Ph,{value:R.nacionalidade||"__none__",onValueChange:e=>I(a=>({...a,nacionalidade:e})),children:[(0,t.jsx)(d.i4,{children:(0,t.jsx)(d.ki,{placeholder:"Selecione"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"__none__",children:"Nenhuma"}),H.map(e=>(0,t.jsx)(d.Ql,{value:e,children:e},e))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Valor (€)"}),(0,t.jsx)(m.I,{value:R.valor,onChange:e=>I(a=>({...a,valor:e.target.value})),placeholder:"Ex: 1.000,00 ou 1000",inputMode:"decimal"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Origem"}),(0,t.jsx)(m.I,{value:R.source,onChange:e=>I(a=>({...a,source:e.target.value}))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Respons\xe1vel"}),(0,t.jsxs)(d.Ph,{value:R.assignee_user_id||"__none__",onValueChange:e=>I(a=>({...a,assignee_user_id:e})),children:[(0,t.jsx)(d.i4,{children:(0,t.jsx)(d.ki,{placeholder:"Selecione"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"__none__",children:"Nenhum"}),s.map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.name||e.email},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Notas"}),(0,t.jsx)("textarea",{className:"w-full min-h-[100px] rounded-md border px-3 py-2 text-sm",value:R.notes,onChange:e=>I(a=>({...a,notes:e.target.value}))})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(r.z,{onClick:ed,disabled:k,children:"Salvar"}),(0,t.jsx)(r.z,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"})]})]}):(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold",children:R.title}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:R.source})]}),R.email&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(Y.Z,{className:"size-4 text-muted-foreground"}),(0,t.jsx)("a",{href:"mailto:".concat(R.email),className:"text-sm hover:underline",children:R.email})]}),(R.phone||R.whatsapp)&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(W.Z,{className:"size-4 text-muted-foreground"}),(0,t.jsxs)("span",{className:"text-sm",children:["+",R.phone_country_code," ",R.phone||R.whatsapp]}),(0,t.jsx)(r.z,{size:"sm",variant:"outline",asChild:!0,children:(0,t.jsx)("a",{href:function(e,a){let s=(e+a).replace(/\D/g,"");return s?"https://wa.me/".concat(s):"#"}(R.phone_country_code,R.phone||R.whatsapp||""),target:"_blank",rel:"noopener noreferrer",children:"Entrar em contato (WhatsApp)"})})]}),R.website&&(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(M.Z,{className:"size-4 text-muted-foreground"}),(0,t.jsx)("a",{href:R.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm hover:underline truncate",children:R.website})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Respons\xe1vel"}),(0,t.jsxs)(d.Ph,{value:R.assignee_user_id||"__none__",onValueChange:er,children:[(0,t.jsx)(d.i4,{className:"mt-1",children:(0,t.jsx)(d.ki,{placeholder:"Selecione"})}),(0,t.jsxs)(d.Bw,{children:[(0,t.jsx)(d.Ql,{value:"__none__",children:"N\xe3o atribu\xeddo"}),s.map(e=>(0,t.jsx)(d.Ql,{value:e.id,children:e.name||e.email},e.id))]})]})]}),R.resumo&&(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Resumo"}),(0,t.jsx)("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:R.resumo})]}),(R.nacionalidade&&"__none__"!==R.nacionalidade||R.valor)&&(0,t.jsxs)("div",{className:"flex gap-4",children:[R.nacionalidade&&"__none__"!==R.nacionalidade&&(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Nacionalidade"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:R.nacionalidade})]}),R.valor&&(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Valor"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:(0,g.x)(R.valor)})]})]}),R.notes&&(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Notas"}),(0,t.jsx)("p",{className:"text-sm mt-1 whitespace-pre-wrap",children:R.notes})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Tags"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1 mt-2",children:em.map(e=>(0,t.jsxs)(A.C,{variant:"secondary",className:"cursor-pointer",onClick:()=>eu(e.tag),children:[e.tag," \xd7"]},e.tag))}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,t.jsx)(m.I,{placeholder:"Nova tag",value:et,onChange:e=>en(e.target.value),onKeyDown:e=>"Enter"===e.key&&(e.preventDefault(),ec())}),(0,t.jsx)(r.z,{size:"sm",onClick:ec,children:"Adicionar"})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 pt-4",children:[(0,t.jsx)(r.z,{onClick:()=>F(!0),children:"Editar"}),h&&(0,t.jsxs)(r.z,{variant:"destructive",onClick:el,children:[(0,t.jsx)(b.Z,{className:"mr-2 size-4"}),"Excluir lead"]}),(0,t.jsxs)("div",{className:"flex gap-2 flex-1",children:[(0,t.jsx)(m.I,{placeholder:"Adicionar nota...",value:ea,onChange:e=>es(e.target.value)}),(0,t.jsx)(r.z,{size:"sm",onClick:eo,children:(0,t.jsx)($.Z,{className:"size-4"})})]})]})]})}),(0,t.jsx)(O,{value:"activity",className:"mt-4",children:(0,t.jsx)(T,{className:"h-[400px]",children:(0,t.jsx)("div",{className:"space-y-3",children:0===_.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhuma atividade registrada"}):_.map((e,a)=>{var n,i;return(0,t.jsxs)("div",{className:"rounded-lg border p-3 text-sm",children:[(0,t.jsxs)("p",{className:"font-medium",children:["stage_change"===e.type&&"Est\xe1gio alterado","assignee_change"===e.type&&(()=>{var a,t;let n=e.payload,i=(null==n?void 0:n.old_assignee_id)?null===(a=s.find(e=>e.id===n.old_assignee_id))||void 0===a?void 0:a.name:null,l=(null==n?void 0:n.new_assignee_id)?null===(t=s.find(e=>e.id===n.new_assignee_id))||void 0===t?void 0:t.name:null;return i&&l?"Respons\xe1vel: ".concat(i," → ").concat(l):l?"Respons\xe1vel: ".concat(l):i?"Respons\xe1vel removido (era ".concat(i,")"):"Respons\xe1vel alterado"})(),"field_edit"===e.type&&"Dados editados","note_added"===e.type&&"Nota: ".concat((null===(n=e.payload)||void 0===n?void 0:n.note)||""),"tag_added"===e.type&&"Tag adicionada: ".concat((null===(i=e.payload)||void 0===i?void 0:i.tag)||""),"created"===e.type&&"Lead criado"]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.created_at).toLocaleString("pt-BR")})]},a)})})})}),(0,t.jsxs)(O,{value:"tasks",className:"mt-4",children:[(0,t.jsx)("div",{className:"mb-3",children:(0,t.jsxs)(r.z,{size:"sm",onClick:()=>Q(!0),children:[(0,t.jsx)(l.Z,{className:"mr-2 size-4"}),"Adicionar tarefa"]})}),(0,t.jsx)(T,{className:"h-[360px]",children:(0,t.jsx)("div",{className:"space-y-3",children:0===N.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Nenhuma tarefa"}):N.map(e=>(0,t.jsxs)("div",{className:"group rounded-lg border p-3 text-sm flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.title}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.status," •"," ",e.due_date?new Date(e.due_date).toLocaleDateString("pt-BR"):"Sem data"]})]}),(0,t.jsxs)("div",{className:"flex gap-1 shrink-0 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,t.jsx)(r.z,{variant:"ghost",size:"icon",className:"size-8",onClick:a=>{a.stopPropagation(),ee({id:e.id,title:e.title,description:e.description||null,due_date:e.due_date||null,status:e.status,assigned_to:e.assigned_to||null}),G(!0)},children:(0,t.jsx)(C.Z,{className:"size-4"})}),(0,t.jsx)(r.z,{variant:"ghost",size:"icon",className:"size-8 text-destructive hover:text-destructive",onClick:a=>{a.stopPropagation(),confirm("Excluir esta tarefa?")&&ei.from("tasks").delete().eq("id",e.id).then(a=>{let{error:s}=a;s?f.Am.error((0,g.e)(s,"Erro ao excluir")):(y(a=>a.filter(a=>a.id!==e.id)),f.Am.success("Tarefa exclu\xedda"))})},children:(0,t.jsx)(b.Z,{className:"size-4"})})]})]},e.id))})}),(0,t.jsx)(X,{open:P,onOpenChange:Q,leadId:a,onTaskCreated:()=>{ei.from("tasks").select("*").eq("lead_id",a).order("due_date",{ascending:!0}).then(e=>{let{data:a}=e;return y(a||[])})},members:s}),(0,t.jsx)(K.t,{open:U,onOpenChange:G,task:J,onTaskUpdated:()=>{ei.from("tasks").select("*").eq("lead_id",a).order("due_date",{ascending:!0}).then(e=>{let{data:a}=e;return y(a||[])})},members:s})]})]}):null]})})}function J(e){let{open:a,onOpenChange:s,onAdd:i}=e,[l,d]=(0,n.useState)(""),[o,c]=(0,n.useState)(!1),h=async e=>{if(e.preventDefault(),l.trim()){c(!0);try{await i(l.trim()),d(""),s(!1)}finally{c(!1)}}};return(0,t.jsx)(u.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(u.cZ,{children:[(0,t.jsxs)(u.fK,{children:[(0,t.jsx)(u.$N,{children:"Adicionar est\xe1gio"}),(0,t.jsx)(u.Be,{children:"Crie um novo est\xe1gio no pipeline"})]}),(0,t.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(x._,{children:"Nome do est\xe1gio"}),(0,t.jsx)(m.I,{value:l,onChange:e=>d(e.target.value),placeholder:"Ex: Proposta",disabled:o})]}),(0,t.jsxs)(u.cN,{children:[(0,t.jsx)(r.z,{type:"button",variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),(0,t.jsx)(r.z,{type:"submit",disabled:o||!l.trim(),children:"Adicionar"})]})]})]})})}function ee(e){let{pipelineId:a,stages:s,members:d}=e,o=(0,i.useRouter)(),[u,m]=(0,n.useState)(s);(0,n.useEffect)(()=>{m(s)},[s]);let[x,h]=(0,n.useState)(null),[p,g]=(0,n.useState)(null),[j,v]=(0,n.useState)(!1),_=(0,c.e)(),N=(0,D.Dy)((0,D.VT)(D.MA,{activationConstraint:{distance:10}}),(0,D.VT)(D.LO,{activationConstraint:{delay:200,tolerance:8}})),y=async(e,a,s)=>{let{error:t}=await _.from("leads").update({stage_id:a,position:s}).eq("id",e);return t?(f.Am.error("Erro ao mover lead"),!1):(await _.from("lead_activities").insert({lead_id:e,type:"stage_change",payload:{new_stage_id:a}}),!0)},C=async e=>{g(null);let{active:a,over:t}=e;if(!t)return;let n=String(a.id),i=String(t.id);if(n.startsWith("lead-")){let e=n.replace("lead-",""),a=i.startsWith("stage-")?i.replace("stage-",""):null,t=i.startsWith("lead-")?i.replace("lead-",""):null;if(a)m(s=>{let t=s.map(e=>({...e,leads:[...e.leads]})),n=t.find(a=>a.leads.some(a=>a.id===e)),i=null==n?void 0:n.leads.find(a=>a.id===e);if(!n||!i)return s;n.leads=n.leads.filter(a=>a.id!==e);let l=t.find(e=>e.id===a);return l&&l.leads.push(i),t}),await y(e,a,0)?f.Am.success("Lead movido"):m(s);else if(t){let a=u.find(e=>e.leads.some(e=>e.id===t));if(!a)return;m(s=>{let n=s.map(e=>({...e,leads:[...e.leads]})),i=n.find(a=>a.leads.some(a=>a.id===e)),l=null==i?void 0:i.leads.find(a=>a.id===e);if(!i||!l)return s;i.leads=i.leads.filter(a=>a.id!==e);let r=n.find(e=>e.id===a.id);if(r){let e=r.leads.findIndex(e=>e.id===t);r.leads.splice(e+1,0,l)}return n});let n=a.leads.findIndex(e=>e.id===t);await y(e,a.id,n+1)?f.Am.success("Lead movido"):m(s)}}},b=e=>{m(a=>a.map(a=>a.id===e.stage_id?{...a,leads:[...a.leads,e]}:a)),h(e.id)},w=async e=>{let{error:a}=await _.from("leads").delete().eq("id",e);if(a){f.Am.error("Erro ao excluir lead");return}h(null),m(a=>a.map(a=>({...a,leads:a.leads.filter(a=>a.id!==e)}))),f.Am.success("Lead exclu\xeddo"),o.refresh()},E=async(e,a)=>{let{error:s}=await _.from("stages").update({name:a}).eq("id",e);if(s)throw f.Am.error("Erro ao renomear est\xe1gio"),s;m(s=>s.map(s=>s.id===e?{...s,name:a}:s)),f.Am.success("Est\xe1gio renomeado")},A=async e=>{let a=u.find(a=>a.id===e);if(!a)return;if(a.leads.length>0){f.Am.error("Mova os leads para outro est\xe1gio antes de excluir");return}if(u.length<=1){f.Am.error("O pipeline precisa ter pelo menos um est\xe1gio");return}let{error:s}=await _.from("stages").delete().eq("id",e);if(s){f.Am.error("Erro ao excluir est\xe1gio");return}m(a=>a.filter(a=>a.id!==e)),f.Am.success("Est\xe1gio exclu\xeddo")},k=async e=>{let s=Math.max(...u.map(e=>e.position),-1),{data:t,error:n}=await _.from("stages").insert({pipeline_id:a,name:e,position:s+1}).select().single();if(n)throw f.Am.error("Erro ao adicionar est\xe1gio"),n;m(e=>[...e,{...t,leads:[]}]),f.Am.success("Est\xe1gio adicionado")};return(0,t.jsxs)(D.LB,{sensors:N,onDragStart:e=>{let a=String(e.active.id);if(a.startsWith("lead-")){let e=a.replace("lead-","");for(let a of u){let s=a.leads.find(a=>a.id===e);if(s){g(s);break}}}},onDragEnd:C,children:[(0,t.jsxs)("div",{className:"flex gap-4 overflow-x-auto pb-4 h-full min-h-[400px]",children:[u.map(e=>(0,t.jsx)(R,{stage:e,onLeadClick:e=>h(e),onLeadCreated:b,onLeadDelete:w,pipelineId:a,onEditStage:E,onDeleteStage:A,canEditStages:!0},e.id)),(0,t.jsx)("div",{className:"flex w-72 shrink-0 flex-col items-center justify-center rounded-lg border border-dashed",children:(0,t.jsxs)(r.z,{variant:"ghost",className:"text-muted-foreground",onClick:()=>v(!0),children:[(0,t.jsx)(l.Z,{className:"mr-2 size-4"}),"Adicionar est\xe1gio"]})})]}),(0,t.jsx)(D.y9,{dropAnimation:{duration:200,easing:"cubic-bezier(0.18, 0.67, 0.6, 1.22)"},children:p?(0,t.jsx)(I,{lead:p}):null}),(0,t.jsx)(J,{open:j,onOpenChange:v,onAdd:k}),x&&(0,t.jsx)(G,{leadId:x,pipelineId:a,members:d,open:!!x,onClose:()=>h(null),onUpdate:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&h(null),o.refresh()},onDelete:w})]})}function ea(e){let{pipelineId:a,pipelines:s,stagesWithLeads:i,members:l,description:r}=e,[d,o]=(0,n.useState)("__all__"),c=(0,n.useMemo)(()=>"__all__"===d?i:"__unassigned__"===d?i.map(e=>({...e,leads:e.leads.filter(e=>!e.assignee_user_id)})):i.map(e=>({...e,leads:e.leads.filter(e=>e.assignee_user_id===d)})),[d,i]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(_,{pipelines:s,currentPipelineId:a,stages:i,members:l,assigneeFilter:d,onAssigneeFilterChange:o}),r&&(0,t.jsx)("p",{className:"text-muted-foreground mb-2 text-sm",children:r}),(0,t.jsx)(ee,{pipelineId:a,stages:c,members:l})]})}},6246:function(e,a,s){"use strict";s.d(a,{Q5:function(){return d},qE:function(){return r}});var t=s(7437),n=s(2265),i=s(3360),l=s(3448);let r=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.fC,{ref:a,className:(0,l.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",s),...n})});r.displayName=i.fC.displayName,n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.Ee,{ref:a,className:(0,l.cn)("aspect-square h-full w-full",s),...n})}).displayName=i.Ee.displayName;let d=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.NY,{ref:a,className:(0,l.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",s),...n})});d.displayName=i.NY.displayName},2060:function(e,a,s){"use strict";s.d(a,{$F:function(){return u},AW:function(){return m},Xi:function(){return x},h_:function(){return c}});var t=s(7437),n=s(2265),i=s(6661),l=s(407),r=s(401),d=s(519),o=s(3448);let c=i.fC,u=i.xz;i.ZA,i.Uv,i.Tr,i.Ee,n.forwardRef((e,a)=>{let{className:s,inset:n,children:r,...d}=e;return(0,t.jsxs)(i.fF,{ref:a,className:(0,o.cn)("flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",s),...d,children:[r,(0,t.jsx)(l.Z,{className:"ml-auto"})]})}).displayName=i.fF.displayName,n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.tu,{ref:a,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...n})}).displayName=i.tu.displayName;let m=n.forwardRef((e,a)=>{let{className:s,sideOffset:n=4,...l}=e;return(0,t.jsx)(i.Uv,{children:(0,t.jsx)(i.VY,{ref:a,sideOffset:n,className:(0,o.cn)("z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]",s),...l})})});m.displayName=i.VY.displayName;let x=n.forwardRef((e,a)=>{let{className:s,inset:n,...l}=e;return(0,t.jsx)(i.ck,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0",n&&"pl-8",s),...l})});x.displayName=i.ck.displayName,n.forwardRef((e,a)=>{let{className:s,children:n,checked:l,...d}=e;return(0,t.jsxs)(i.oC,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...d,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(i.wU,{children:(0,t.jsx)(r.Z,{className:"h-4 w-4"})})}),n]})}).displayName=i.oC.displayName,n.forwardRef((e,a)=>{let{className:s,children:n,...l}=e;return(0,t.jsxs)(i.Rk,{ref:a,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,t.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,t.jsx)(i.wU,{children:(0,t.jsx)(d.Z,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=i.Rk.displayName,n.forwardRef((e,a)=>{let{className:s,inset:n,...l}=e;return(0,t.jsx)(i.__,{ref:a,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...l})}).displayName=i.__.displayName,n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.Z0,{ref:a,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...n})}).displayName=i.Z0.displayName},1032:function(e,a,s){"use strict";s.d(a,{Ei:function(){return f},Tu:function(){return h},bC:function(){return p},ue:function(){return x},yo:function(){return o}});var t=s(7437),n=s(2265),i=s(1904),l=s(535),r=s(2489),d=s(3448);let o=i.fC;i.xz,i.x8;let c=i.h_,u=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.aV,{className:(0,d.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...n,ref:a})});u.displayName=i.aV.displayName;let m=(0,l.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),x=n.forwardRef((e,a)=>{let{side:s="right",className:n,children:l,...o}=e;return(0,t.jsxs)(c,{children:[(0,t.jsx)(u,{}),(0,t.jsxs)(i.VY,{ref:a,className:(0,d.cn)(m({side:s}),n),...o,children:[(0,t.jsxs)(i.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,t.jsx)(r.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]}),l]})]})});x.displayName=i.VY.displayName;let h=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};h.displayName="SheetHeader";let p=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.Dx,{ref:a,className:(0,d.cn)("text-lg font-semibold text-foreground",s),...n})});p.displayName=i.Dx.displayName;let f=n.forwardRef((e,a)=>{let{className:s,...n}=e;return(0,t.jsx)(i.dk,{ref:a,className:(0,d.cn)("text-sm text-muted-foreground",s),...n})});f.displayName=i.dk.displayName},9140:function(e,a,s){"use strict";s.d(a,{O:function(){return i}});var t=s(7437),n=s(3448);function i(e){let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,n.cn)("animate-pulse rounded-md bg-primary/10",a),...s})}},7673:function(e,a,s){"use strict";s.d(a,{PipelineNameProvider:function(){return l},V:function(){return r}});var t=s(7437),n=s(2265);let i=(0,n.createContext)({pipelineName:null,setPipelineName:()=>{}});function l(e){let{children:a}=e,[s,l]=(0,n.useState)(null);return(0,t.jsx)(i.Provider,{value:{pipelineName:s,setPipelineName:l},children:a})}function r(){return(0,n.useContext)(i)}}},function(e){e.O(0,[208,438,530,559,590,2,745,610,282,78,971,117,744],function(){return e(e.s=4414)}),_N_E=e.O()}]);