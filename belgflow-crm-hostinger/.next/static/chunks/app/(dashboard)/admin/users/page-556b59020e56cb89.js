(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[792],{5873:function(e,r,t){Promise.resolve().then(t.bind(t,9717))},9717:function(e,r,t){"use strict";t.d(r,{AdminUsersContent:function(){return g}});var s=t(7437),n=t(2265),a=t(9376),i=t(8933),o=t(3804),l=t(2381),d=t(9174),c=t(8245),u=t(4291),f=t(5060),m=t(9397),p=t(279),x=t(4438);function h(e){let{open:r,onOpenChange:t,onUserCreated:a}=e,[i,o]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),[m,h]=(0,n.useState)(""),[g,b]=(0,n.useState)(!1),j=async e=>{if(e.preventDefault(),!i.trim()){x.Am.error("Email \xe9 obrigat\xf3rio");return}b(!0);try{let e=await fetch("/api/admin/create-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i.trim(),name:d.trim()||null,password:m||null})}),r=await e.json();if(!e.ok)throw Error(r.error||"Erro ao criar usu\xe1rio");o(""),c(""),h(""),t(!1),a(),x.Am.success("Usu\xe1rio criado! Envie o link de redefini\xe7\xe3o de senha se necess\xe1rio.")}catch(e){x.Am.error(e instanceof Error?e.message:"Erro ao criar usu\xe1rio")}finally{b(!1)}},v=()=>{o(""),c(""),h(""),t(!1)};return(0,s.jsx)(u.Vq,{open:r,onOpenChange:v,children:(0,s.jsxs)(u.cZ,{children:[(0,s.jsxs)(u.fK,{children:[(0,s.jsx)(u.$N,{children:"Adicionar usu\xe1rio"}),(0,s.jsx)(u.Be,{children:"Crie um novo usu\xe1rio. Se n\xe3o definir senha, o usu\xe1rio poder\xe1 redefinir via email."})]}),(0,s.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(f._,{htmlFor:"user-email",children:"Email *"}),(0,s.jsx)(p.I,{id:"user-email",type:"email",placeholder:"usuario@empresa.com",value:i,onChange:e=>o(e.target.value),required:!0,disabled:g})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(f._,{htmlFor:"user-name",children:"Nome"}),(0,s.jsx)(p.I,{id:"user-name",placeholder:"Nome completo",value:d,onChange:e=>c(e.target.value),disabled:g})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(f._,{htmlFor:"user-password",children:"Senha (opcional)"}),(0,s.jsx)(p.I,{id:"user-password",type:"password",placeholder:"Deixe em branco para convite por email",value:m,onChange:e=>h(e.target.value),disabled:g})]}),(0,s.jsxs)(u.cN,{children:[(0,s.jsx)(l.z,{type:"button",variant:"outline",onClick:v,children:"Cancelar"}),(0,s.jsx)(l.z,{type:"submit",disabled:g||!i.trim(),children:g?"Criando...":"Criar usu\xe1rio"})]})]})]})})}function g(e){let{users:r,pipelines:t,pipelineMembers:p}=e,g=(0,a.useRouter)(),[b,j]=(0,n.useState)(null),[v,y]=(0,n.useState)(!1),[N,w]=(0,n.useState)({}),[C,_]=(0,n.useState)(!1),A=e=>p.filter(r=>r.user_id===e).map(e=>e.pipeline_id),k=e=>{j(e),w({[e]:A(e)})},z=(e,r)=>{w(t=>{let s=t[e]||A(e),n=s.includes(r);return{...t,[e]:n?s.filter(e=>e!==r):[...s,r]}})},I=async()=>{if(!b)return;_(!0);let e=(0,i.e)(),r=N[b]||[];try{await e.from("pipeline_members").delete().eq("user_id",b),r.length>0&&await e.from("pipeline_members").insert(r.map(e=>({pipeline_id:e,user_id:b,role_in_pipeline:"member"}))),x.Am.success("Acesso atualizado"),j(null),g.refresh()}catch(e){x.Am.error("Erro ao atualizar")}finally{_(!1)}},R=async(e,r)=>{let t=(0,i.e)(),{error:s}=await t.from("profiles").update({role_global:r?"MEMBER":"ADMIN"}).eq("id",e);s?x.Am.error("Erro ao alterar permiss\xe3o"):(x.Am.success("Permiss\xe3o atualizada"),g.refresh())},S=async(e,r)=>{let t=(0,i.e)(),{error:s}=await t.from("profiles").update({is_active:!r}).eq("id",e);s?x.Am.error("Erro ao alterar status"):(x.Am.success("Status atualizado"),g.refresh())};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Usu\xe1rios"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Gerencie usu\xe1rios, pap\xe9is e acesso a pipelines"})]}),(0,s.jsxs)(l.z,{onClick:()=>y(!0),children:[(0,s.jsx)(m.Z,{className:"mr-2 size-4"}),"Adicionar usu\xe1rio"]})]}),(0,s.jsx)(h,{open:v,onOpenChange:y,onUserCreated:()=>g.refresh()}),(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(o.iA,{children:[(0,s.jsx)(o.xD,{children:(0,s.jsxs)(o.SC,{children:[(0,s.jsx)(o.ss,{children:"Nome"}),(0,s.jsx)(o.ss,{children:"Email"}),(0,s.jsx)(o.ss,{children:"Papel"}),(0,s.jsx)(o.ss,{children:"Status"}),(0,s.jsx)(o.ss,{children:"Acesso Pipelines"}),(0,s.jsx)(o.ss,{children:"A\xe7\xf5es"})]})}),(0,s.jsx)(o.RM,{children:r.map(e=>(0,s.jsxs)(o.SC,{children:[(0,s.jsx)(o.pj,{children:e.name||"-"}),(0,s.jsx)(o.pj,{children:e.email}),(0,s.jsx)(o.pj,{children:(0,s.jsx)(d.C,{variant:"ADMIN"===e.role_global?"default":"secondary",children:e.role_global})}),(0,s.jsx)(o.pj,{children:(0,s.jsx)(d.C,{variant:e.is_active?"outline":"destructive",children:e.is_active?"Ativo":"Inativo"})}),(0,s.jsxs)(o.pj,{children:[A(e.id).length," pipeline(s)"]}),(0,s.jsx)(o.pj,{children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>k(e.id),children:"Acesso"}),"ADMIN"!==e.role_global&&(0,s.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>R(e.id,!0),children:"Tornar Admin"}),"ADMIN"===e.role_global&&r.filter(e=>"ADMIN"===e.role_global).length>1&&(0,s.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>R(e.id,!1),children:"Remover Admin"}),(0,s.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>S(e.id,e.is_active),children:e.is_active?"Desativar":"Ativar"})]})})]},e.id))})]})}),(0,s.jsx)(u.Vq,{open:!!b,onOpenChange:()=>j(null),children:(0,s.jsxs)(u.cZ,{children:[(0,s.jsxs)(u.fK,{children:[(0,s.jsx)(u.$N,{children:"Acesso a Pipelines"}),(0,s.jsx)(u.Be,{children:"Selecione os pipelines que este usu\xe1rio pode acessar"})]}),(0,s.jsx)("div",{className:"space-y-2 py-4",children:t.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c.X,{id:"pipeline-".concat(e.id),checked:(N[b]||A(b)).includes(e.id),onCheckedChange:()=>b&&z(b,e.id)}),(0,s.jsx)(f._,{htmlFor:"pipeline-".concat(e.id),children:e.name})]},e.id))}),(0,s.jsxs)(u.cN,{children:[(0,s.jsx)(l.z,{variant:"outline",onClick:()=>j(null),children:"Cancelar"}),(0,s.jsx)(l.z,{onClick:I,disabled:C,children:"Salvar"})]})]})})]})}},9174:function(e,r,t){"use strict";t.d(r,{C:function(){return o}});var s=t(7437);t(2265);var n=t(535),a=t(3448);let i=(0,n.j)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:r,variant:t,...n}=e;return(0,s.jsx)("div",{className:(0,a.cn)(i({variant:t}),r),...n})}},2381:function(e,r,t){"use strict";t.d(r,{z:function(){return d}});var s=t(7437),n=t(2265),a=t(7053),i=t(535),o=t(3448);let l=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=n.forwardRef((e,r)=>{let{className:t,variant:n,size:i,asChild:d=!1,...c}=e,u=d?a.g7:"button";return(0,s.jsx)(u,{className:(0,o.cn)(l({variant:n,size:i,className:t})),ref:r,...c})});d.displayName="Button"},8245:function(e,r,t){"use strict";t.d(r,{X:function(){return l}});var s=t(7437),n=t(2265),a=t(7637),i=t(401),o=t(3448);let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)(a.fC,{ref:r,className:(0,o.cn)("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...n,children:(0,s.jsx)(a.z$,{className:(0,o.cn)("grid place-content-center text-current"),children:(0,s.jsx)(i.Z,{className:"h-4 w-4"})})})});l.displayName=a.fC.displayName},4291:function(e,r,t){"use strict";t.d(r,{$N:function(){return p},Be:function(){return x},Vq:function(){return l},cN:function(){return m},cZ:function(){return u},fK:function(){return f}});var s=t(7437),n=t(2265),a=t(1904),i=t(2489),o=t(3448);let l=a.fC;a.xz;let d=a.h_;a.x8;let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)(a.aV,{ref:r,className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n})});c.displayName=a.aV.displayName;let u=n.forwardRef((e,r)=>{let{className:t,children:n,...l}=e;return(0,s.jsxs)(d,{children:[(0,s.jsx)(c,{}),(0,s.jsxs)(a.VY,{ref:r,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[n,(0,s.jsxs)(a.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(i.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=a.VY.displayName;let f=e=>{let{className:r,...t}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col space-y-1.5 text-center sm:text-left",r),...t})};f.displayName="DialogHeader";let m=e=>{let{className:r,...t}=e;return(0,s.jsx)("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t})};m.displayName="DialogFooter";let p=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)(a.Dx,{ref:r,className:(0,o.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})});p.displayName=a.Dx.displayName;let x=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)(a.dk,{ref:r,className:(0,o.cn)("text-sm text-muted-foreground",t),...n})});x.displayName=a.dk.displayName},279:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var s=t(7437),n=t(2265),a=t(3448);let i=n.forwardRef((e,r)=>{let{className:t,type:n,...i}=e;return(0,s.jsx)("input",{type:n,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...i})});i.displayName="Input"},5060:function(e,r,t){"use strict";t.d(r,{_:function(){return d}});var s=t(7437),n=t(2265),a=t(6394),i=t(535),o=t(3448);let l=(0,i.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)(a.f,{ref:r,className:(0,o.cn)(l(),t),...n})});d.displayName=a.f.displayName},3804:function(e,r,t){"use strict";t.d(r,{RM:function(){return l},SC:function(){return d},iA:function(){return i},pj:function(){return u},ss:function(){return c},xD:function(){return o}});var s=t(7437),n=t(2265),a=t(3448);let i=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:r,className:(0,a.cn)("w-full caption-bottom text-sm",t),...n})})});i.displayName="Table";let o=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("thead",{ref:r,className:(0,a.cn)("[&_tr]:border-b",t),...n})});o.displayName="TableHeader";let l=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("tbody",{ref:r,className:(0,a.cn)("[&_tr:last-child]:border-0",t),...n})});l.displayName="TableBody",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("tfoot",{ref:r,className:(0,a.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...n})}).displayName="TableFooter";let d=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("tr",{ref:r,className:(0,a.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...n})});d.displayName="TableRow";let c=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("th",{ref:r,className:(0,a.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})});c.displayName="TableHead";let u=n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("td",{ref:r,className:(0,a.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})});u.displayName="TableCell",n.forwardRef((e,r)=>{let{className:t,...n}=e;return(0,s.jsx)("caption",{ref:r,className:(0,a.cn)("mt-4 text-sm text-muted-foreground",t),...n})}).displayName="TableCaption"},8933:function(e,r,t){"use strict";t.d(r,{e:function(){return n}});var s=t(1259);function n(){return(0,s.createBrowserClient)("https://belgiflow-supabase.bnw7is.easypanel.host","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE")}},3448:function(e,r,t){"use strict";t.d(r,{cn:function(){return a},e:function(){return o},x:function(){return i}});var s=t(1994),n=t(3335);function a(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,n.m6)((0,s.W)(r))}function i(e){let r=null==e?NaN:Number(e);return Number.isNaN(r)?"":r.toLocaleString("nl-BE",{style:"currency",currency:"EUR"})}function o(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Ocorreu um erro";if(!e)return r;let t=(null==e?void 0:e.message)||(null==e?void 0:e.details)||(null==e?void 0:e.hint);return"string"==typeof t&&t.trim()?t.trim():e instanceof Error&&e.message?e.message:"string"==typeof e?e:r}}},function(e){e.O(0,[208,438,530,559,590,83,971,117,744],function(){return e(e.s=5873)}),_N_E=e.O()}]);